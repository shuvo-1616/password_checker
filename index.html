<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Checker Pro+</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #f4f7fa; font-family: 'Segoe UI', sans-serif; padding: 20px; }
.container { max-width: 900px; margin:auto; background:#fff; padding:25px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.1);}
h2 { text-align:center; margin-bottom:10px; }
p { text-align:center; color:#555; margin-bottom:25px; }
input { width:100%; padding:12px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc; }
button { padding:12px 20px; border:none; border-radius:6px; background:#4a90e2; color:white; font-size:16px; cursor:pointer; transition:0.3s; }
button:hover { background:#357ab7; }
.strength-bar { height:15px; width:100%; border-radius:8px; background:#eee; margin-top:5px; overflow:hidden; }
.strength-fill { height:100%; width:0%; transition:0.3s; }
.badge { margin-right:5px; }
.result-box { margin-top:25px; padding:15px; background:#f6f8fa; border-radius:8px; font-family: monospace; white-space: pre-wrap; word-wrap: break-word; font-size:14px; }
.warning { color:#e74c3c; font-weight:bold; }
.success { color:#27ae60; font-weight:bold; }
</style>
</head>
<body>

<div class="container">
  <h2>Password Checker Pro+</h2>
  <p>Live analysis with strength, breach, reuse, MFA & predictive metrics</p>

  <input id="password" type="password" placeholder="Enter password...">
  <div class="strength-bar"><div id="strength-fill" class="strength-fill"></div></div>
  <input id="user_id" type="text" placeholder="Optional user id for reuse/MFA checks">
  <button onclick="checkPassword()">Analyze Password</button>

  <div id="badges" class="mt-3"></div>

  <div class="result-box" id="out">{ }</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
<script>
async function checkPassword(){
  const pw = document.getElementById('password').value;
  const user_id = document.getElementById('user_id').value || null;

  if(!pw){ alert("Password required"); return; }

  const res = await fetch('/api/check',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({password: pw, user_id:user_id})
  });
  const json = await res.json();
  document.getElementById('out').textContent = JSON.stringify(json,null,2);

  updateStrengthBar(json.strength.score);
  updateBadges(json);
}

function updateStrengthBar(score){
  const bar = document.getElementById('strength-fill');
  let width = (score/6)*100;
  bar.style.width = width + "%";
  if(score<=2){ bar.style.background="#e74c3c"; }
  else if(score==3){ bar.style.background="#f39c12"; }
  else if(score==4){ bar.style.background="#2ecc71"; }
  else{ bar.style.background="#27ae60"; }
}

function updateBadges(json){
  const badges = document.getElementById('badges');
  badges.innerHTML = "";

  // pwned
  if(json.pwned?.pwned){
    const b = document.createElement('span');
    b.className = "badge bg-danger";
    b.textContent = `⚠️ Pwned (${json.pwned.count || 'unknown'} times)`;
    badges.appendChild(b);
  }

  // reuse
  if(json.context?.reuse?.reused){
    const b = document.createElement('span');
    b.className = "badge bg-warning text-dark";
    b.textContent = "⚠️ Password Reused";
    badges.appendChild(b);
  }

  // MFA
  if(json.context?.mfa?.mfa_enabled){
    const b = document.createElement('span');
    b.className = "badge bg-success";
    b.textContent = "✅ MFA Enabled";
    badges.appendChild(b);
  }

  // fuzzy
  if(json.fuzzy?.similar_count > 0){
    const b = document.createElement('span');
    b.className = "badge bg-secondary";
    b.textContent = `⚠️ Similar to ${json.fuzzy.similar_count} leaked passwords`;
    badges.appendChild(b);
  }

  // predictive crack time
  if(json.predictive?.crack_time_seconds){
    const b = document.createElement('span');
    b.className = "badge bg-info text-dark";
    let seconds = json.predictive.crack_time_seconds;
    let timeStr = seconds < 60 ? `${Math.round(seconds)} sec` :
                  seconds < 3600 ? `${Math.round(seconds/60)} min` :
                  seconds < 86400 ? `${Math.round(seconds/3600)} hr` :
                  `${Math.round(seconds/86400)} days`;
    b.textContent = `⏱ Estimated Crack Time: ${timeStr}`;
    badges.appendChild(b);
  }
}

// live typing strength update (zxcvbn)
document.getElementById('password').addEventListener('input', ()=>{
  const val = document.getElementById('password').value;
  if(!val) { updateStrengthBar(0); return; }
  const result = zxcvbn(val);
  const score = result.score + 1; // zxcvbn score 0-4
  updateStrengthBar(score);
});
</script>

</body>
</html>